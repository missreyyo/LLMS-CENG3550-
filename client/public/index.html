<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethereum IPFS Metamask Example</title>
</head>
<body>
    <h1>Ethereum IPFS Metamask Example</h1>
    <div>
        <label for="ipfsInput">Text to be uploaded to IPFS:</label>
        <input type="text" id="ipfsInput">
        <button onclick="uploadToIPFS()">Upload to IPFS</button>
    </div>
    <div>
        <p>IPFS Hash: <span id="ipfsHash"></span></p>
        <p>Contract IPFS Hash: <span id="contractHash"></span></p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ipfs-http-client@46.0.0/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script>
    <script src="App.js"></script>

    <script>
        window.onload = async () => {
            // Connect to Metamask
            if (window.ethereum) {
                window.web3 = new Web3(window.ethereum);
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });

                    // Connect to IPFS
                    window.ipfs = createIPFSInstance();

                    displayContractHash();
                } catch (error) {
                    console.error("User denied account access");
                }
            } else {
                console.error("No web3 provider detected");
            }
        };

        function createIPFSInstance() {
            return window.IpfsHttpClient({ host: 'ipfs.infura.io', port: 5001, protocol: 'https', headers: { authorization: '1dab7f3ee54c42de8baa0cd86ae1cd3e' } });
        }

        async function uploadToIPFS() {
            const textToUpload = document.getElementById("ipfsInput").value;

            try {
                // Upload to IPFS
                const ipfsResponse = await window.ipfs.add(textToUpload);
                const ipfsHash = ipfsResponse.cid.toString();

                // Update UI
                document.getElementById("ipfsHash").innerText = ipfsHash;

                // Set IPFS Hash in the Smart Contract
                const accounts = await window.web3.eth.getAccounts();


                
 
                await setIPFSHash(ipfsHash, accounts[0]);

                // Update UI with Contract IPFS Hash
                displayContractHash();
            } catch (error) {
                console.error("Error uploading to IPFS:", error);
            }
        }
    </script>
</body>
</html>

